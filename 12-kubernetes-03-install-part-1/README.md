# Домашнее задание к занятию "12.3 Развертывание кластера на собственных серверах, лекция 1"

## Модуль 12. Администрирование кластера Kubernetes

### Студент: Иван Жиляев

>Поработав с персональным кластером, можно заняться проектами. Вам пришла задача подготовить кластер под новый проект.

## Задание 1: Описать требования к кластеру
>Сначала проекту необходимо определить требуемые ресурсы. Известно, что проекту нужны база данных, система кеширования, а само приложение состоит из бекенда и фронтенда. Опишите, какие ресурсы нужны, если известно:
>
>* база данных должна быть отказоустойчивой (не менее трех копий, master-slave) и потребляет около 4 ГБ ОЗУ в работе;
>* кэш должен быть аналогично отказоустойчивый, более трех копий, потребление: 4 ГБ ОЗУ, 1 ядро;
>* фронтенд обрабатывает внешние запросы быстро, отдавая статику: не более 50 МБ ОЗУ на каждый экземпляр;
>* бекенду требуется больше: порядка 600 МБ ОЗУ и по 1 ядру на копию.
>
>Требования: опишите, сколько нод в кластере и сколько ресурсов (ядра, ОЗУ, диск) нужно для запуска приложения. Расчет вести из необходимости запуска 5 копий фронтенда и 10 копий бекенда, база и кеш.

Формальный расчёт ресурсов для запроса выглядит так:

| Потребитель | Нужно ЦП, ядра  | Нужно ОЗУ, Гб | Нужно диска, Гб | Количество потребителей | Суммарно ЦП, ядра | Суммарно ОЗУ, Гб  | Суммарно диска, Гб  |
| ----------- |:---------------:|:-------------:|:---------------:|:-----------------------:|:-----------------:|:-----------------:|:-------------------:|
| БД          | 2               | 4             | 75              | 3                       | 6                 | 12                | 225                 |
| кэш         | 1               | 4             | 10              | 3                       | 3                 | 12                | 30                  |
| фронтенд    | 0,1             | 0,05          | 1               | 5                       | 0,5               | 0,15              | 5                   |
| бекенд      | 1               | 0,6           | 5               | 10                      | 10                | 6                 | 50                  |
| мастер k8s  | 2               | 2             | 50              | 3                       | 6                 | 6                 | 150                 |
|             |                 |               |                 |                         |                   |                   |                     |
| __Итого__   | -               | -             | -               | -                       | __26__            | __37__            | __460__             |


Считаю, что для получившейся нагрузки будет достаточно шести нод.  
Добавим к промежуточным цифрам служебную нагрузку от шести инстансов k8s:

| Потребитель         | Нужно ЦП, ядра  | Нужно ОЗУ, Гб | Нужно диска, Гб | Количество потребителей | Суммарно ЦП, ядра | Суммарно ОЗУ, Гб  | Суммарно диска, Гб  |
| ------------------- |:---------------:|:-------------:|:---------------:|:-----------------------:|:-----------------:|:-----------------:|:-------------------:|
| Промежуточный итог  | -               | -             | -               | -                       | 26                | 37                | 460                 |
| Служебная нагрузка  | 1               | 1             | 100             | 6                       | 6                 | 6                 | 600                 |
|                     |                 |               |                 |                         |                   |                   |                     |
| __Итого__           | -               | -             | -               | -                       | __32__            | __43__            | __1060__            |

При подсчёте конечных значений разделим полученные цифры на шесть нод, округлим до целого в большую сторону и получится, что каждая нода должна иметь 6 ядер ЦП, 8 ГБ ОЗУ и 180 Гб дискового пространства.


Не забудем учесть, что хотелось бы нормально пережить падение хотя бы одной ноды кубернетиса. Это означает, что стоит дополнительно заказать ещё одну. Так что финально нам нужно __семь__ ВМ по 6 ядер ЦП, 8 ГБ ОЗУ и 180 Гб дискового пространства каждая.
