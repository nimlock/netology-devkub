# Домашнее задание к занятию "12.3 Развертывание кластера на собственных серверах, лекция 1"

## Модуль 12. Администрирование кластера Kubernetes

### Студент: Иван Жиляев

>Поработав с персональным кластером, можно заняться проектами. Вам пришла задача подготовить кластер под новый проект.

## Задание 1: Описать требования к кластеру
>Сначала проекту необходимо определить требуемые ресурсы. Известно, что проекту нужны база данных, система кеширования, а само приложение состоит из бекенда и фронтенда. Опишите, какие ресурсы нужны, если известно:
>
>* база данных должна быть отказоустойчивой (не менее трех копий, master-slave) и потребляет около 4 ГБ ОЗУ в работе;
>* кэш должен быть аналогично отказоустойчивый, более трех копий, потребление: 4 ГБ ОЗУ, 1 ядро;
>* фронтенд обрабатывает внешние запросы быстро, отдавая статику: не более 50 МБ ОЗУ на каждый экземпляр;
>* бекенду требуется больше: порядка 600 МБ ОЗУ и по 1 ядру на копию.
>
>Требования: опишите, сколько нод в кластере и сколько ресурсов (ядра, ОЗУ, диск) нужно для запуска приложения. Расчет вести из необходимости запуска 5 копий фронтенда и 10 копий бекенда, база и кеш.

Для начала нужно посчитать ресурсы для мастер-нод: для отказоустойчивости стоит поднять __три мастера__, 
каждому можно выделить минимальные ресурсы - ЦП 2 ядра, ОЗУ 2Гб, диск 50 Гб.

Для обеспечения неплохой отказоустойчивости при приемлемых затратах русурсов инстансы БД и кэша (по три штуки для каждого сервиса) я бы расположил на трёх воркер-нодах кубера так, чтобы на каждой было по одному экземпляру каждого сервиса. При этом мастер-экземпляры этих сервисов стоит разнести на разные воркеры для оптимизации нагрузки в случае аварии - чтобы не упали разом два мастера разных служб.

Промежуточный итог: под БД и кэш нужно __три воркера__ 4 ядра и 10 Гб ОЗУ.

При расчёте ресурсов для бэкенда и фронтенда я буду отталкиваться от того, что хотелось бы нормально пережить падение одного из воркеров кубернетиса. В таком случае оптимальным представляется использование трёх воркеров, где мощность каждого будет складываться из гипотетической максимальной нагрузки при аварии на одной ноде и размазывании нагрузки по двум оставшимся:
  - служебное потребление кубернетса - ЦП 1 ядро, ОЗУ 1 Гб, диск 100 Гб
  - 5 копий бэкенда - ЦП 5 ядер, ОЗУ 3 Гб
  - 3 копии фронтенда - ЦП 0.3 ядра, ОЗУ 150 Мб

Так что под фронт и бэк нужно __три ноды__ по 6 ядер и 4 Гб ОЗУ.

Всего в кластере потребуется __9 нод__, три группы по три ноды под разные задачи.
